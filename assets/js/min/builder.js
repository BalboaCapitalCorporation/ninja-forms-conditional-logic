!function(){var e,n,t;!function(i){function o(e,n){return C.call(e,n)}function l(e,n){var t,i,o,l,c,r,d,a,s,u,h,f=n&&n.split("/"),p=v.map,g=p&&p["*"]||{};if(e&&"."===e.charAt(0))if(n){for(e=e.split("/"),c=e.length-1,v.nodeIdCompat&&b.test(e[c])&&(e[c]=e[c].replace(b,"")),e=f.slice(0,f.length-1).concat(e),s=0;s<e.length;s+=1)if(h=e[s],"."===h)e.splice(s,1),s-=1;else if(".."===h){if(1===s&&(".."===e[2]||".."===e[0]))break;s>0&&(e.splice(s-1,2),s-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((f||g)&&p){for(t=e.split("/"),s=t.length;s>0;s-=1){if(i=t.slice(0,s).join("/"),f)for(u=f.length;u>0;u-=1)if(o=p[f.slice(0,u).join("/")],o&&(o=o[i])){l=o,r=s;break}if(l)break;!d&&g&&g[i]&&(d=g[i],a=s)}!l&&d&&(l=d,r=a),l&&(t.splice(0,r,l),e=t.join("/"))}return e}function c(e,n){return function(){var t=M.call(arguments,0);return"string"!=typeof t[0]&&1===t.length&&t.push(null),f.apply(i,t.concat([e,n]))}}function r(e){return function(n){return l(n,e)}}function d(e){return function(n){m[e]=n}}function a(e){if(o(w,e)){var n=w[e];delete w[e],k[e]=!0,h.apply(i,n)}if(!o(m,e)&&!o(k,e))throw new Error("No "+e);return m[e]}function s(e){var n,t=e?e.indexOf("!"):-1;return t>-1&&(n=e.substring(0,t),e=e.substring(t+1,e.length)),[n,e]}function u(e){return function(){return v&&v.config&&v.config[e]||{}}}var h,f,p,g,m={},w={},v={},k={},C=Object.prototype.hasOwnProperty,M=[].slice,b=/\.js$/;p=function(e,n){var t,i=s(e),o=i[0];return e=i[1],o&&(o=l(o,n),t=a(o)),o?e=t&&t.normalize?t.normalize(e,r(n)):l(e,n):(e=l(e,n),i=s(e),o=i[0],e=i[1],o&&(t=a(o))),{f:o?o+"!"+e:e,n:e,pr:o,p:t}},g={require:function(e){return c(e)},exports:function(e){var n=m[e];return"undefined"!=typeof n?n:m[e]={}},module:function(e){return{id:e,uri:"",exports:m[e],config:u(e)}}},h=function(e,n,t,l){var r,s,u,h,f,v,C=[],M=typeof t;if(l=l||e,"undefined"===M||"function"===M){for(n=!n.length&&t.length?["require","exports","module"]:n,f=0;f<n.length;f+=1)if(h=p(n[f],l),s=h.f,"require"===s)C[f]=g.require(e);else if("exports"===s)C[f]=g.exports(e),v=!0;else if("module"===s)r=C[f]=g.module(e);else if(o(m,s)||o(w,s)||o(k,s))C[f]=a(s);else{if(!h.p)throw new Error(e+" missing "+s);h.p.load(h.n,c(l,!0),d(s),{}),C[f]=m[s]}u=t?t.apply(m[e],C):void 0,e&&(r&&r.exports!==i&&r.exports!==m[e]?m[e]=r.exports:u===i&&v||(m[e]=u))}else e&&(m[e]=t)},e=n=f=function(e,n,t,o,l){if("string"==typeof e)return g[e]?g[e](n):a(p(e,n).f);if(!e.splice){if(v=e,v.deps&&f(v.deps,v.callback),!n)return;n.splice?(e=n,n=t,t=null):e=i}return n=n||function(){},"function"==typeof t&&(t=o,o=l),o?h(i,e,n,t):setTimeout(function(){h(i,e,n,t)},4),f},f.config=function(e){return f(e)},e._defined=m,t=function(e,n,t){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");n.splice||(t=n,n=[]),o(m,e)||o(w,e)||(w[e]=[e,n,t])},t.amd={jQuery:!0}}(),t("../lib/almond",function(){}),t("controllers/templateHelpers",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("conditions"),"init:model",this.addTemplateHelpers),this.listenTo(i.channel("conditions"),"init:thenModel",this.addTemplateHelpers),this.listenTo(i.channel("conditions"),"init:whenModel",this.addTemplateHelpers)},addTemplateHelpers:function(e){e.set("renderFieldSelect",this.renderFieldSelect),e.set("renderComparatorSelect",this.renderComparatorSelect)},renderFieldSelect:function(e){var n=i.channel("fields").request("get:collection"),t=i.channel("settings").request("get:setting","calculations"),o=_.template(jQuery("#nf-tmpl-field-select").html());return o({calcCollection:t,fieldCollection:n,currentValue:e})},renderComparatorSelect:function(e){var n=_.template(jQuery("#nf-tmpl-comparator-select").html());return n({comparator:e})}});return e}),t("views/andItem",[],function(){var e=Marionette.ItemView.extend({template:"#nf-tmpl-and-item",onRender:function(){},events:{"change .setting":"changeSetting","click .nf-delete-and":"clickDelete"},changeSetting:function(e){i.channel("conditions").trigger("change:setting",e,this.model)},clickDelete:function(e){i.channel("conditions").trigger("click:deleteAnd",e,this.model)}});return e}),t("views/firstWhenItem",[],function(){var e=Marionette.ItemView.extend({template:"#nf-tmpl-first-when-item",events:{"change .setting":"changeSetting"},changeSetting:function(e){i.channel("conditions").trigger("change:setting",e,this.model)}});return e}),t("views/andCollection",["views/andItem","views/firstWhenItem"],function(e,n){var t=Marionette.CollectionView.extend({getChildView:function(t){return t.collection.first()==t?n:e},initialize:function(e){this.whenDiv=e.whenDiv,this.conditionModel=e.conditionModel},attachHtml:function(e,n,t){0==t?this.whenDiv.append(n.el):this.conditionModel.get("collapsed")||(e.isBuffering?e._bufferedChildren.splice(t,0,n):e._insertBefore(n,t)||e._insertAfter(n))}});return t}),t("views/thenItem",[],function(){var e=Marionette.ItemView.extend({template:"#nf-tmpl-then-item",events:{"change .setting":"changeSetting","click .nf-delete-then":"clickDelete"},changeSetting:function(e){i.channel("conditions").trigger("change:setting",e,this.model)},clickDelete:function(e){i.channel("conditions").trigger("click:deleteThen",e,this.model)}});return e}),t("views/thenCollection",["views/thenItem"],function(e){var n=Marionette.CollectionView.extend({childView:e,initialize:function(e){}});return n}),t("views/conditionItem",["views/andCollection","views/thenCollection"],function(e,n){var t=Marionette.LayoutView.extend({template:"#nf-tmpl-condition",regions:{and:".nf-and-region",then:".nf-then-region"},initialize:function(){this.listenTo(this.model,"change:collapsed",this.render),this.listenTo(i.channel("drawer"),"closed",this.drawerClosed)},onRender:function(){var t=jQuery(this.el).find(".nf-when");this.and.show(new e({collection:this.model.get("when"),whenDiv:t,conditionModel:this.model})),this.model.get("collapsed")||this.then.show(new n({collection:this.model.get("then")}))},events:{"click .nf-delete-condition":"clickDelete","click .nf-collapse-condition":"clickCollapse","click .nf-add-and":"clickAddAnd","click .nf-add-then":"clickAddThen"},clickDelete:function(e){i.channel("conditions").trigger("click:deleteCondition",e,this.model)},clickCollapse:function(e){i.channel("conditions").trigger("click:collapseCondition",e,this.model)},clickAddAnd:function(e){i.channel("conditions").trigger("click:addAnd",e,this.model)},clickAddThen:function(e){i.channel("conditions").trigger("click:addThen",e,this.model)}});return t}),t("views/conditionCollection",["views/conditionItem"],function(e){var n=Marionette.CollectionView.extend({childView:e,initialize:function(e){this.collection=e.dataModel.get("conditions")}});return n}),t("controllers/returnChildView",["views/conditionCollection"],function(e){var n=Marionette.Object.extend({initialize:function(){i.channel("cl_condition").reply("get:settingChildView",this.testChildView)},testChildView:function(n){return e}});return n}),t("models/whenModel",[],function(){var e=Backbone.Model.extend({defaults:{connector:"AND",key:"",comparator:"",value:""},initialize:function(){i.channel("conditions").trigger("init:thenModel",this)}});return e}),t("models/whenCollection",["models/whenModel"],function(e){var n=Backbone.Collection.extend({model:e,initialize:function(e,n){this.options=n}});return n}),t("models/thenModel",[],function(){var e=Backbone.Model.extend({defaults:{key:"",trigger:"",value:""},initialize:function(){i.channel("conditions").trigger("init:thenModel",this)}});return e}),t("models/thenCollection",["models/thenModel"],function(e){var n=Backbone.Collection.extend({model:e,initialize:function(e,n){this.options=n}});return n}),t("models/conditionModel",["models/whenCollection","models/thenCollection"],function(e,n){var t=Backbone.Model.extend({defaults:{collapsed:!1},initialize:function(){this.set("when",new e(this.get("when"))),this.set("then",new n(this.get("then"))),i.channel("conditions").trigger("init:model",this)}});return t}),t("models/conditionCollection",["models/conditionModel"],function(e){var n=Backbone.Collection.extend({model:e,initialize:function(e,n){this.options=n}});return n}),t("views/drawerHeader",[],function(){var e=Marionette.ItemView.extend({template:"#nf-tmpl-drawer-header",events:{"click .nf-add-new":"clickAddNew"},clickAddNew:function(e){i.channel("conditions").trigger("click:addNew",e)}});return e}),t("controllers/newCondition",["models/whenCollection","models/whenModel"],function(e,n){var t=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("conditions"),"click:addNew",this.addNew)},addNew:function(e){var n=i.channel("settings").request("get:setting","conditions");n.add({when:[{}],then:[{}]}),i.channel("app").request("update:setting","clean",!1),i.channel("app").request("update:db")}});return t}),t("controllers/updateSettings",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("conditions"),"change:setting",this.updateSetting)},updateSetting:function(e,n){var t=jQuery(e.target).val(),o=jQuery(e.target).data("id");n.set(o,t),i.channel("app").request("update:setting","clean",!1),i.channel("app").request("update:db")}});return e}),t("controllers/clickControls",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("conditions"),"click:deleteCondition",this.deleteCondition),this.listenTo(i.channel("conditions"),"click:collapseCondition",this.collapseCondition),this.listenTo(i.channel("conditions"),"click:deleteAnd",this.deleteAnd),this.listenTo(i.channel("conditions"),"click:deleteThen",this.deleteAnd),this.listenTo(i.channel("conditions"),"click:addAnd",this.addAnd),this.listenTo(i.channel("conditions"),"click:addThen",this.addThen)},deleteCondition:function(e,n){n.collection.remove(n),i.channel("app").request("update:setting","clean",!1),i.channel("app").request("update:db")},collapseCondition:function(e,n){n.set("collapsed",!n.get("collapsed")),i.channel("app").request("update:setting","clean",!1),i.channel("app").request("update:db")},deleteAnd:function(e,n){n.collection.remove(n),i.channel("app").request("update:setting","clean",!1),i.channel("app").request("update:db")},deleteThen:function(e,n){n.collection.remove(n),i.channel("app").request("update:setting","clean",!1),i.channel("app").request("update:db")},addAnd:function(e,n){n.get("when").add({}),i.channel("app").request("update:setting","clean",!1),i.channel("app").request("update:db")},addThen:function(e,n){n.get("then").add({}),i.channel("app").request("update:setting","clean",!1),i.channel("app").request("update:db")}});return e});var i=Backbone.Radio;n(["controllers/templateHelpers","controllers/returnChildView","models/conditionCollection","views/drawerHeader","controllers/newCondition","controllers/updateSettings","controllers/clickControls"],function(e,n,t,o,l,c,r){var d=Marionette.Application.extend({initialize:function(e){this.listenTo(i.channel("app"),"after:appStart",this.afterNFLoad)},onStart:function(){new e,new n,new l,new c,new r,i.channel("conditional_logic").reply("get:drawerHeaderView",this.test,this)},afterNFLoad:function(e){var n=i.channel("settings").request("get:setting","conditions");n&&!1==n instanceof Backbone.Collection&&(n=new t(n),i.channel("settings").request("update:setting","conditions",n,!0))},test:function(){return o}}),a=new d;a.start()}),t("main",function(){})}();
//# sourceMappingURL=almond.build.js.map
//# sourceMappingURL=builder.js.map
