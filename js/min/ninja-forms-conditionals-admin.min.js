jQuery(document).ready(function(e){function u(t){var n=e("input[name^=ninja_forms_field_"+t+"]");var r=jQuery(n).serializeFullArray();return r}nf_cl.getParam=function(e){for(var t in nf_cl.cr_param_groups){for(var n in nf_cl.cr_param_groups[t]){if(nf_cl.cr_param_groups[t][n]["id"]==e){return nf_cl.cr_param_groups[t][n]}}}return null};var t=Backbone.View.extend({el:e("#nf_cl_conditions"),events:{"click .add-condition":"addCondition","click .delete-condition":"deleteCondition","click .add-cr":"addCriteria","click .delete-cr":"deleteCriteria","change .cr-param":"changeParam"},initialize:function(){_.bindAll(this,"render");this.render()},render:function(){if(typeof nf_cl.conditions!="undefined"){for(id in nf_cl.conditions){s.render(id)}}},addCondition:function(t){t.preventDefault();if("DIV"==t.target.tagName){e(t.target).parent().hide()}else{e(t.target).hide()}s.render("new")},deleteCondition:function(t){t.preventDefault();e(t.target).parent().parent().parent().remove();e(this.el).find(".nf-cl-add").show()},addCriteria:function(t){t.preventDefault();var n=e(t.target).data("cond-id");var r="new";var s="";var o="";var u="==";i.conditionEl=e("#nf_cl_condition_"+n);i.renderCriteriaRow(n,r,nf_cl.cr_param_groups,s,o,u)},deleteCriteria:function(t){t.preventDefault();targetEl=e(t.target).parent().parent();e(targetEl).remove()},changeParam:function(t){t.preventDefault();var n=e(t.target).data("cr-id");var r=e(t.target).data("cond-id");var s=e(t.target).val();var o="";var u="";if("new"==n){var a=e(t.target).data("num");var f="conditions["+r+"][criteria][new]["+a+"]";var l="nf_cr_new_"+a}else{var a="";var f="conditions["+r+"][criteria]["+n+"]";var l="nf_cr_"+n}i.renderCriteriaCompare(n,f,nf_cl.cr_param_groups,s,u,a,l);i.renderCriteriaValue(n,f,nf_cl.cr_param_groups,s,o,a,l);var c=nf_cl.getParam(s);if(c.type=="date"){e(t.target).next().next().find("input").datepicker({dateFormat:ninja_forms_settings.date_format})}}});var n=Backbone.View.extend({el:e("#nf_cl_conditions"),initialize:function(){_.bindAll(this,"render")},render:function(t){if(typeof nf_cl.conditions[t]!="undefined"){var n=nf_cl.conditions[t].action;var r=nf_cl.conditions[t].connector}else{var n="";var r=""}var s=_.template(e("#tmpl-nf-cl-condition").html(),{cond_id:t,action:n,connector:r});e(this.el).append(s);i.renderCriteriaRows(t)}});var r=Backbone.View.extend({conditionEl:"",initialize:function(){_.bindAll(this,"render")},renderCriteriaRows:function(t){if("new"==t){return false}this.conditionEl=e("#nf_cl_condition_"+t);var n=nf_cl.conditions[t];var r=n.criteria;var i=this;_.each(r,function(e){var n=e.id;var r=e.param;var s=e.value;var o=e.compare;i.renderCriteriaRow(t,n,nf_cl.cr_param_groups,r,s,o)})},renderCriteriaRow:function(t,n,r,i,s,o){if("new"==n){var u=e(this.conditionEl).find(".single-criteria").length;var a="conditions["+t+"][criteria][new]["+u+"]";var f="nf_cr_new_"+u;var l="new-"+u}else{var u="";var a="conditions["+t+"][criteria]["+n+"]";var f="nf_cr_"+n;var l=n}var c=_.template(e("#tmpl-nf-cl-criteria").html(),{cr_id:n,cr_name:a,param_groups:r,selected_param:i,value:s,compare:o,num:u,div_id:f,data_id:l,cond_id:t});e(this.conditionEl).find(".nf-cl-criteria").append(c);this.renderCriteriaCompare(n,a,r,i,o,u,f);this.renderCriteriaValue(n,a,r,i,s,u,f)},renderCriteriaCompare:function(t,n,r,i,s,o,u){var a=e("#"+u).find(".cr-compare");var f=_.template(e("#tmpl-nf-cl-criteria-compare").html(),{cr_id:t,cr_name:n,param_groups:r,selected_param:i,compare:s,nf_cl:nf_cl});e(a).html(f)},renderCriteriaValue:function(t,n,r,i,s,o,u){var a=e("#"+u).find(".cr-value");var f=_.template(e("#tmpl-nf-cl-criteria-value").html(),{cr_id:t,cr_name:n,param_groups:r,selected_param:i,value:s,num:o,nf_cl:nf_cl});e(a).html(f);var l=nf_cl.getParam(i);if(l&&l.type=="date"){e(a).find("input").datepicker({dateFormat:ninja_forms_settings.date_format})}}});var i=new r;var s=new n;var o=new t;e(document).on("change",".ninja-forms-field-list-show-value",function(){var t=this.id.replace("ninja_forms_field_","");t=t.replace("_list_show_value","");var n=new Object;if(this.checked){e(".ninja-forms-field-"+t+"-list-option-value").each(function(){var r=this.id.replace("ninja_forms_field_"+t+"_list_option_","");r=r.replace("_value_span","");n[r]=e(this).children(".ninja-forms-field-list-option-value").val()});e(".ninja-forms-field-"+t+"-list-option-value").show();e(".ninja-forms-field-conditional-cr-field").each(function(){if(this.value==t){e(this).nextElementInDom(".ninja-forms-field-conditional-cr-value-list:first").children("option").each(function(){this.value=n[this.title]})}});e(".ninja-forms-field-"+t+"-conditional-value").each(function(){e(this).children("option").each(function(){this.value=n[this.title]})})}else{e("#ninja_forms_field_"+t+"_list_options").children(".ninja-forms-field-"+t+"-list-option").find(".ninja-forms-field-list-option-label").each(function(){var r=e(this).parent().parent().parent().parent().parent().prop("id");var i=r.replace("ninja_forms_field_"+t+"_list_option_","");n[i]=this.value});e(".ninja-forms-field-conditional-cr-field").each(function(){if(this.value==t){e(this).nextElementInDom(".ninja-forms-field-conditional-cr-value-list:first").children("option").each(function(){this.value=n[this.title]})}});e(".ninja-forms-field-"+t+"-conditional-value").each(function(){e(this).children("option").each(function(){this.value=n[this.title]})});e(".ninja-forms-field-"+t+"-list-option-value").hide()}});e(document).on("change",".ninja-forms-field-conditional-action",function(){var t=this.id.replace("action","value");var n=this.id.replace("action","value_label");var r=e("#_form_id").val();var i=e(this).parent().parent().attr("name");var s=e("#ninja_forms_field_"+i+"_conditional_value_type").val();var o=e("#ninja_forms_field_"+i+"_list_show_value").prop("checked");var a=e(".ninja-forms-field-"+i+"-conditional").length;a--;var f=this.value;var l=u(i);e.post(ajaxurl,{form_id:r,field_id:i,x:a,action_slug:f,field_data:l,action:"ninja_forms_change_action"},function(n){e("#ninja_forms_field_"+i+"_"+a+"_value_span").prop("innerHTML",n.new_html);if(n.new_type=="list"){e("#"+t).children().remove().end();e(".ninja-forms-field-"+i+"-list-option").each(function(){var n=e(this).find(".ninja-forms-field-list-option-label").val();if(o){var r=e(this).find(".ninja-forms-field-list-option-value").val()}else{var r=n}var s=this.id.replace("ninja_forms_field_"+i+"_list_option_","");e("#"+t).append('<option value="'+r+'" title="'+s+'">'+n+"</option>")})}})});e(document).on("click",".ninja-forms-field-add-conditional",function(t){t.preventDefault();var n=this.id.replace("ninja_forms_field_","");n=n.replace("_add_conditional","");var r=e("#_form_id").val();var i=e(".ninja-forms-field-"+n+"-conditional").length;e.post(ajaxurl,{form_id:r,field_id:n,x:i,action:"ninja_forms_add_conditional"},function(t){e("#ninja_forms_field_"+n+"_conditionals").append(t)})});e(document).on("click",".ninja-forms-field-remove-conditional",function(t){t.preventDefault();var n=this.id.replace("ninja_forms_field_","");n=n.replace("_remove_conditional","");var r=this.name;e("#ninja_forms_field_"+n+"_conditional_"+r).remove()});e(document).on("click",".ninja-forms-field-add-cr",function(t){t.preventDefault();var n=this.id.replace("ninja_forms_field_","");n=n.replace("_add_cr","");var r=e("#_form_id").val();var i=this.name;var s=e(".ninja-forms-field-"+n+"-conditional-"+i+"-cr").length;e.post(ajaxurl,{form_id:r,field_id:n,x:i,y:s,action:"ninja_forms_add_cr"},function(t){e("#ninja_forms_field_"+n+"_conditional_"+i+"_cr").append(t.new_html);var r="";var s="";e(".ninja-forms-field-title").each(function(){r=this.innerHTML;if(r.length>30){r=r.substring(0,30)+"..."}s=this.id.replace("ninja_forms_field_","");s=s.replace("_title","");e(".ninja-forms-field-conditional-cr-field > option").each(function(){if(this.value==s){this.text="ID: "+s+" - "+r}})})})});e(document).on("click",".ninja-forms-field-remove-cr",function(t){t.preventDefault();var n=this.id.replace("ninja_forms_field_","");n=n.replace("_remove_cr","");var r=this.name;var i=this.rel;e("#ninja_forms_field_"+n+"_conditional_"+r+"_cr_"+i).remove()});e(document).on("change",".ninja-forms-field-conditional-cr-field",function(){var t=this.id.replace("ninja_forms_field_","");t=t.replace("_cr_field","");var n=this.title.split("_");var r=n[0];var i=n[1];var s=this.value;if(this.value!=""){e.post(ajaxurl,{field_id:t,field_value:s,x:r,y:i,output_options:0,action:"ninja_forms_change_cr_field"},function(n){e("#ninja_forms_field_"+t+"_conditional_"+r+"_cr_"+i+"_value").prop("innerHTML",n.new_html);if(n.new_type=="list"){e(".ninja-forms-field-"+s+"-list-option").each(function(){var n=e(this).find(".ninja-forms-field-list-option-label").val();if(e("#ninja_forms_field_"+s+"_list_show_value").prop("checked")==true){var o=e(this).find(".ninja-forms-field-list-option-value").val()}else{var o=n}var u=this.id.replace("ninja_forms_field_"+s+"_list_option_","");e('select[name="ninja_forms_field_'+t+"\\[conditional\\]\\["+r+"\\]\\[cr\\]\\["+i+'\\]\\[value\\]"]').append('<option value="'+o+'" title="'+u+'">'+n+"</option>")})}})}else{e("#ninja_forms_field_"+t+"_conditional_"+r+"_cr_"+i+"_value").prop("innerHTML","")}});e(document).on("change",".ninja-forms-notification-conditional-cr-field",function(){var t=this.id.replace("ninja_forms_field_","");t=t.replace("_cr_field","");var n=this.title.split("_");var r=n[0];var i=n[1];var s=this.value;if(this.value!=""){e.post(ajaxurl,{field_id:t,field_value:s,x:r,y:i,output_options:1,action:"ninja_forms_change_cr_field"},function(n){e("#ninja_forms_field_"+t+"_conditional_"+r+"_cr_"+i+"_value").prop("innerHTML",n.new_html);if(n.new_type=="list"){e(".ninja-forms-field-"+s+"-list-option").each(function(){var n=e(this).find(".ninja-forms-field-list-option-label").val();if(e("#ninja_forms_field_"+s+"_list_show_value").prop("checked")==true){var o=e(this).find(".ninja-forms-field-list-option-value").val()}else{var o=n}var u=this.id.replace("ninja_forms_field_"+s+"_list_option_","");e('select[name="ninja_forms_field_'+t+"\\[conditional\\]\\["+r+"\\]\\[cr\\]\\["+i+'\\]\\[value\\]"]').append('<option value="'+o+'" title="'+u+'">'+n+"</option>")})}})}else{e("#ninja_forms_field_"+t+"_conditional_"+r+"_cr_"+i+"_value").prop("innerHTML","")}});e(document).on("addField.clAdd",function(t,n){e(".ninja-forms-field-conditional-cr-field").each(function(){e(this).append('<option value="'+n.new_id+'">'+n.new_type+"</option>")})})})